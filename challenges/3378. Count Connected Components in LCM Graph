var countComponents = function(nums, threshold) {
    const n = nums.length;
    const parent = Array(n).fill(0).map((_,i)=>i);
    const find = x => parent[x]===x?x:parent[x]=find(parent[x]);
    const union = (a,b)=>{ a=find(a); b=find(b); if(a!==b) parent[a]=b; };
    const lists = Array.from({length: threshold+1}, ()=>[]);
    for(let i=0;i<n;i++){
        const v = nums[i];
        if(v>threshold) continue;
        for(let k=v;k<=threshold;k+=v) lists[k].push(i);
    }
    for(let k=1;k<=threshold;k++){
        const arr = lists[k];
        if(arr.length<2) continue;
        const a0 = arr[0];
        for(let t=1;t<arr.length;t++) union(a0, arr[t]);
    }
    let cnt = 0;
    for(let i=0;i<n;i++) if(find(i)===i) cnt++;
    return cnt;
};
